<%inherit file="/people/profile-header.xhtml" />
<%namespace name="profile" file="/people/profile-header.xhtml"/>
<%block name="details">
  ${profile.header()}
  %if request.session.peek_flash('tokens'):
      <div class="alert alert-info alert-dismissible" role="alert">
        <button type="button" class="close" data-dismiss="alert"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <strong>Your API key:</strong> ${request.session.pop_flash('tokens')[0]}
      </div>
  %endif
  <h3>${_(u'Access Token')}</h3>
  %if permissions and len(permissions) > 0:
      <dl class="dl-horizontal">
        %for perm in permissions:
            <dt>${perm.application}</dt>
            <dd><dfn>Can read plubic info from profile & group</dfn></dd>
            <form>
              <dd>
                <button class="btn btn-default btn-xs" type="submit" name="form.delete.token" value="${perm.token}">${_('revoke')}</button>
              </dd>
            </form>
        %endfor
      </dl>
  %endif
      <button  type="button" class="btn btn-default btn-lg btn-block" data-toggle="modal" data-target="#generateToken">
        Add token
      </button>

  <form class="form-horizontal" role="form" action="${request.application_url + '/people/profile/%i/accesstoken' % person.id}" method="post">
    <div class="modal in" id="generateToken" tabindex="-1" role="dialog" aria-labelledby="GenerateToken" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            <h4 class="modal-title" id="GenerateToken">Add Token for ${person.username}</h4>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="token_description" class="col-sm-2 control-label">Description</label>
                <div class="col-sm-10">
                  <input type="text" class="form-control" name="description" placeholder="${_('Add a name or an description')}">
                </div>
            </div>
    <!--    This is for demo purpose - list will be coming dynamically from core app -->
            <div class="col-sm-offset-2 col-sm-10">
              %for perm in access:
                  <dt>
                    <label>
                      <input type="radio" name="permission" value="${perm[0]}">
                      ${perm[1]}
                    </label>
                  </dt>
              %endfor
            </div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="submit" class="btn btn-primary" name="form.save.token">Generate</button>
          </div>
        </div>
      </div>
    </div>
  </form>
</%block>
